# Nginx as API Gateway (+ static frontend)
upstream auth_service { server auth-service:3000; }
upstream inscripciones_service { server inscripciones-service:3001; }
upstream pagos_service { server pagos-service:3002; }
upstream notifications_service { server notifications-service:3003; }

server {
  listen 80;
  server_name _;

  # Serve frontend
  root /usr/share/nginx/html;
  index index.html;

  # Frontend routes
  location / {
    try_files $uri $uri/ /index.html;
  }

  # Proxy headers
  proxy_set_header Host $host;
  proxy_set_header X-Real-IP $remote_addr;
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header X-Forwarded-Proto $scheme;

  # API Routes (no path rewrite: services already expose /api/...)
  location /api/auth/ {
    proxy_pass http://auth_service;
  }
  location /api/inscripciones/ {
    proxy_pass http://inscripciones_service;
  }
  location /api/pagos/ {
    proxy_pass http://pagos_service;
  }
  location /api/notificaciones/ {
    proxy_pass http://notifications_service;
  }
}
